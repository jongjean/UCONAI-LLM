<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FINAL CHECK - DOM Inspector</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #fff;
        }
        .panel {
            max-width: 1200px;
            margin: 0 auto;
            background: #2d2d2d;
            padding: 30px;
            border-radius: 8px;
        }
        h1 { color: #4ec9b0; }
        h2 { color: #dcdcaa; margin-top: 30px; }
        pre {
            background: #1e1e1e;
            padding: 15px;
            border-radius: 4px;
            overflow: auto;
            border-left: 3px solid #4ec9b0;
        }
        .success { color: #4ec9b0; }
        .error { color: #f48771; }
        .warning { color: #ce9178; }
        button {
            padding: 10px 20px;
            margin: 10px 5px;
            background: #0e639c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
        }
        button:hover { background: #1177bb; }
        .iframe-container {
            margin: 20px 0;
            border: 2px solid #4ec9b0;
            border-radius: 8px;
            overflow: hidden;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: none;
        }
    </style>
</head>
<body>
    <div class="panel">
        <h1>ğŸ”¬ FINAL CHECK: DOM Inspector</h1>
        <p class="warning">ë¯¸ë¦¬ë³´ê¸° í˜ì´ì§€ì˜ ì‹¤ì œ DOM êµ¬ì¡°ì™€ ìŠ¤íƒ€ì¼ì„ ì§ì ‘ í™•ì¸í•©ë‹ˆë‹¤</p>
        
        <h2>1. í…ŒìŠ¤íŠ¸ ëŒ€ìƒ URL</h2>
        <pre>pages/mypage/profile.html</pre>
        
        <h2>2. ì§„ë‹¨ ë²„íŠ¼</h2>
        <button onclick="runFullDiagnosis()">ğŸ” ì „ì²´ ì§„ë‹¨ ì‹¤í–‰</button>
        <button onclick="checkNavigation()">ğŸ§­ ë„¤ë¹„ê²Œì´ì…˜ í™•ì¸</button>
        <button onclick="checkCSS()">ğŸ¨ CSS ê·œì¹™ í™•ì¸</button>
        <button onclick="checkBody()">ğŸ“¦ body íƒœê·¸ í™•ì¸</button>
        
        <div id="results"></div>
        
        <h2>3. ë¯¸ë¦¬ë³´ê¸° í˜ì´ì§€ ë¡œë“œ</h2>
        <div class="iframe-container">
            <iframe id="testFrame" src="pages/mypage/profile.html"></iframe>
        </div>
    </div>

    <script>
        function runFullDiagnosis() {
            const iframe = document.getElementById('testFrame');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            const iframeWindow = iframe.contentWindow;
            
            let report = '<h2>ğŸ“Š ì „ì²´ ì§„ë‹¨ ë³´ê³ ì„œ</h2>';
            
            // 1. body í´ë˜ìŠ¤ í™•ì¸
            report += '<h3 class="success">1. body íƒœê·¸ í´ë˜ìŠ¤</h3><pre>';
            const bodyClasses = Array.from(iframeDoc.body.classList);
            report += `body í´ë˜ìŠ¤ ëª©ë¡: ${bodyClasses.length}ê°œ\n`;
            bodyClasses.forEach(cls => {
                report += `  - ${cls}\n`;
            });
            report += `\nâœ“ user-logged-in: ${iframeDoc.body.classList.contains('user-logged-in') ? '<span class="success">ìˆìŒ</span>' : '<span class="error">ì—†ìŒ âš ï¸</span>'}`;
            report += '</pre>';
            
            // 2. localStorage í™•ì¸
            report += '<h3 class="success">2. localStorage ë°ì´í„°</h3><pre>';
            try {
                const user = iframeWindow.localStorage.getItem('user');
                if (user) {
                    const userData = JSON.parse(user);
                    report += `âœ“ user ë°ì´í„°: <span class="success">ìˆìŒ</span>\n`;
                    report += `  ID: ${userData.id}\n`;
                    report += `  Name: ${userData.name}\n`;
                    report += `  Role: ${userData.role || 'N/A'}\n`;
                } else {
                    report += `<span class="error">âœ— user ë°ì´í„° ì—†ìŒ</span>`;
                }
            } catch (e) {
                report += `<span class="error">ì—ëŸ¬: ${e.message}</span>`;
            }
            report += '</pre>';
            
            // 3. ë“œë¡­ë‹¤ìš´ ë©”ë‰´ í™•ì¸
            report += '<h3 class="success">3. ë“œë¡­ë‹¤ìš´ ë©”ë‰´ êµ¬ì¡°</h3><pre>';
            const dropdownMenus = iframeDoc.querySelectorAll('.dropdown-menu');
            report += `ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ì´ ê°œìˆ˜: ${dropdownMenus.length}ê°œ\n\n`;
            
            dropdownMenus.forEach((menu, idx) => {
                const parentLi = menu.closest('.nav-item');
                const parentLink = parentLi ? parentLi.querySelector('.nav-link') : null;
                const menuName = parentLink ? parentLink.textContent.trim() : 'ì•Œ ìˆ˜ ì—†ìŒ';
                
                report += `[ë©”ë‰´ ${idx + 1}] ${menuName}\n`;
                
                const loggedOutItems = menu.querySelectorAll('.auth-only.logged-out');
                const loggedInItems = menu.querySelectorAll('.auth-only.logged-in');
                
                report += `  ë¡œê·¸ì•„ì›ƒ ë©”ë‰´: ${loggedOutItems.length}ê°œ\n`;
                loggedOutItems.forEach((item, i) => {
                    const display = iframeWindow.getComputedStyle(item).display;
                    const text = item.textContent.trim().substring(0, 20);
                    report += `    [${i+1}] "${text}" â†’ display: ${display}\n`;
                });
                
                report += `  ë¡œê·¸ì¸ ë©”ë‰´: ${loggedInItems.length}ê°œ\n`;
                loggedInItems.forEach((item, i) => {
                    const display = iframeWindow.getComputedStyle(item).display;
                    const text = item.textContent.trim().substring(0, 20);
                    report += `    [${i+1}] "${text}" â†’ display: ${display}\n`;
                });
                
                report += '\n';
            });
            report += '</pre>';
            
            // 4. ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ í™•ì¸
            report += '<h3 class="success">4. ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼</h3><pre>';
            const logoutBtn = iframeDoc.getElementById('logoutBtn');
            if (logoutBtn) {
                const display = iframeWindow.getComputedStyle(logoutBtn.parentElement).display;
                report += `âœ“ #logoutBtn ìš”ì†Œ: <span class="success">ìˆìŒ</span>\n`;
                report += `  ë¶€ëª¨ li íƒœê·¸ display: ${display}\n`;
                report += `  í…ìŠ¤íŠ¸: "${logoutBtn.textContent.trim()}"\n`;
            } else {
                report += `<span class="error">âœ— #logoutBtn ìš”ì†Œ ì—†ìŒ</span>`;
            }
            report += '</pre>';
            
            // 5. CSS íŒŒì¼ í™•ì¸
            report += '<h3 class="success">5. ë¡œë“œëœ CSS íŒŒì¼</h3><pre>';
            const styleSheets = Array.from(iframeDoc.styleSheets);
            report += `ë¡œë“œëœ CSS íŒŒì¼: ${styleSheets.length}ê°œ\n`;
            styleSheets.forEach((sheet, i) => {
                try {
                    report += `  [${i+1}] ${sheet.href || '(ì¸ë¼ì¸)'}\n`;
                } catch (e) {
                    report += `  [${i+1}] (ì ‘ê·¼ ë¶ˆê°€: CORS)\n`;
                }
            });
            report += '</pre>';
            
            // 6. ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ í™•ì¸
            report += '<h3 class="success">6. ë¡œë“œëœ ìŠ¤í¬ë¦½íŠ¸</h3><pre>';
            const scripts = iframeDoc.querySelectorAll('script[src]');
            report += `ì™¸ë¶€ ìŠ¤í¬ë¦½íŠ¸: ${scripts.length}ê°œ\n`;
            scripts.forEach((script, i) => {
                const src = script.getAttribute('src');
                report += `  [${i+1}] ${src}\n`;
            });
            report += '</pre>';
            
            // ìµœì¢… íŒì •
            report += '<h3 class="warning">ğŸ¯ ìµœì¢… íŒì •</h3><pre>';
            const hasUser = !!iframeWindow.localStorage.getItem('user');
            const hasBodyClass = iframeDoc.body.classList.contains('user-logged-in');
            const hasLogoutBtn = !!iframeDoc.getElementById('logoutBtn');
            
            if (hasUser && hasBodyClass && hasLogoutBtn) {
                report += '<span class="success">âœ… ëª¨ë“  ì¡°ê±´ ì¶©ì¡±: ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ì´ ë³´ì—¬ì•¼ í•©ë‹ˆë‹¤!</span>\n';
                report += '\në§Œì•½ ë³´ì´ì§€ ì•ŠëŠ”ë‹¤ë©´:\n';
                report += '  1. CSS ìºì‹œ ë¬¸ì œ â†’ ê°•ì œ ìƒˆë¡œê³ ì¹¨ (Ctrl+Shift+R)\n';
                report += '  2. ë“œë¡­ë‹¤ìš´ì´ ë‹«í˜€ìˆìŒ â†’ ë§ˆì´í˜ì´ì§€ í´ë¦­\n';
                report += '  3. z-index ë¬¸ì œ â†’ ê°œë°œìë„êµ¬ë¡œ í™•ì¸';
            } else {
                report += '<span class="error">âŒ ë¬¸ì œ ë°œê²¬:</span>\n';
                if (!hasUser) report += '  - localStorageì— user ë°ì´í„° ì—†ìŒ\n';
                if (!hasBodyClass) report += '  - body.user-logged-in í´ë˜ìŠ¤ ì—†ìŒ\n';
                if (!hasLogoutBtn) report += '  - #logoutBtn ìš”ì†Œ ì—†ìŒ\n';
            }
            report += '</pre>';
            
            document.getElementById('results').innerHTML = report;
        }
        
        function checkNavigation() {
            const iframe = document.getElementById('testFrame');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            
            const nav = iframeDoc.querySelector('nav');
            if (nav) {
                console.log('ë„¤ë¹„ê²Œì´ì…˜ HTML:', nav.outerHTML.substring(0, 1000));
                alert('ì½˜ì†”ì— ë„¤ë¹„ê²Œì´ì…˜ HTML ì¶œë ¥ë¨ (F12 í™•ì¸)');
            } else {
                alert('ë„¤ë¹„ê²Œì´ì…˜ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
            }
        }
        
        function checkCSS() {
            const iframe = document.getElementById('testFrame');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            const iframeWindow = iframe.contentWindow;
            
            const testEl = iframeDoc.querySelector('.auth-only.logged-in');
            if (testEl) {
                const styles = iframeWindow.getComputedStyle(testEl);
                console.log('CSS Computed Styles:', {
                    display: styles.display,
                    visibility: styles.visibility,
                    opacity: styles.opacity,
                    height: styles.height
                });
                alert('ì½˜ì†”ì— CSS ìŠ¤íƒ€ì¼ ì¶œë ¥ë¨ (F12 í™•ì¸)');
            } else {
                alert('.auth-only.logged-in ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
            }
        }
        
        function checkBody() {
            const iframe = document.getElementById('testFrame');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            
            console.log('body í´ë˜ìŠ¤:', Array.from(iframeDoc.body.classList));
            console.log('body innerHTML (ì²˜ìŒ 500ì):', iframeDoc.body.innerHTML.substring(0, 500));
            alert('ì½˜ì†”ì— body ì •ë³´ ì¶œë ¥ë¨ (F12 í™•ì¸)');
        }
        
        // iframe ë¡œë“œ ì™„ë£Œ ì‹œ ìë™ ì§„ë‹¨
        window.addEventListener('load', () => {
            const iframe = document.getElementById('testFrame');
            iframe.onload = () => {
                setTimeout(() => {
                    runFullDiagnosis();
                }, 2000); // 2ì´ˆ í›„ ìë™ ì‹¤í–‰
            };
        });
    </script>
</body>
</html>
