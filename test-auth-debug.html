<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auth Debug Test</title>
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            padding: 40px;
            background: #f5f5f5;
        }
        .debug-panel {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1e7e34;
            margin-bottom: 30px;
        }
        .status {
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #ddd;
        }
        .status.success {
            background: #e8f5e9;
            border-color: #4caf50;
        }
        .status.error {
            background: #ffebee;
            border-color: #f44336;
        }
        button {
            padding: 12px 24px;
            margin: 10px 5px;
            background: #1e7e34;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #166028;
        }
        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            overflow: auto;
            font-size: 12px;
        }
        .info {
            padding: 15px;
            margin: 15px 0;
            background: #e3f2fd;
            border-radius: 8px;
            border-left: 4px solid #2196f3;
        }
    </style>
</head>
<body>
    <div class="debug-panel">
        <h1>ğŸ” Auth System Debug</h1>
        
        <div class="info">
            <strong>ëª©ì :</strong> ë¡œê·¸ì¸ ì‹œìŠ¤í…œì´ ì™œ ì‘ë™í•˜ì§€ ì•ŠëŠ”ì§€ ì •í™•íˆ ì§„ë‹¨í•©ë‹ˆë‹¤.
        </div>
        
        <h2>1. í˜„ì¬ ìƒíƒœ í™•ì¸</h2>
        <div id="currentStatus" class="status">í™•ì¸ ì¤‘...</div>
        
        <h2>2. í…ŒìŠ¤íŠ¸ ì‹¤í–‰</h2>
        <button onclick="testSetUser()">âœ… í…ŒìŠ¤íŠ¸ ë¡œê·¸ì¸ ì‹¤í–‰</button>
        <button onclick="testAddBodyClass()">ğŸ¨ Body í´ë˜ìŠ¤ ì¶”ê°€</button>
        <button onclick="testLogout()">ğŸšª ë¡œê·¸ì•„ì›ƒ ì‹¤í–‰</button>
        <button onclick="checkAll()">ğŸ”„ ì „ì²´ ì¬í™•ì¸</button>
        
        <h2>3. ìƒì„¸ ì •ë³´</h2>
        <div id="detailInfo"></div>
    </div>

    <script>
        // 1. í˜„ì¬ ìƒíƒœ í™•ì¸
        function checkAll() {
            const statusDiv = document.getElementById('currentStatus');
            const detailDiv = document.getElementById('detailInfo');
            
            // localStorage í™•ì¸
            const localUser = localStorage.getItem('user');
            const sessionUser = sessionStorage.getItem('user');
            
            // body í´ë˜ìŠ¤ í™•ì¸
            const hasClass = document.body.classList.contains('user-logged-in');
            
            // ê²°ê³¼ í‘œì‹œ
            let html = '<h3>ğŸ“Š ì§„ë‹¨ ê²°ê³¼</h3>';
            html += '<pre>';
            html += `localStorage.user: ${localUser || 'âŒ ì—†ìŒ'}\n`;
            html += `sessionStorage.user: ${sessionUser || 'âŒ ì—†ìŒ'}\n`;
            html += `body.user-logged-in: ${hasClass ? 'âœ… ìˆìŒ' : 'âŒ ì—†ìŒ'}\n`;
            
            if (localUser) {
                try {
                    const user = JSON.parse(localUser);
                    html += `\nì‚¬ìš©ì ì •ë³´:\n`;
                    html += `  - ID: ${user.id}\n`;
                    html += `  - Name: ${user.name}\n`;
                    html += `  - Login Time: ${user.loginTime}\n`;
                } catch (e) {
                    html += `\nâš ï¸ JSON íŒŒì‹± ì˜¤ë¥˜: ${e.message}\n`;
                }
            }
            
            html += '</pre>';
            
            // CSS ìƒíƒœ í™•ì¸
            html += '<h3>ğŸ¨ CSS ìƒíƒœ</h3>';
            html += '<pre>';
            
            const loggedOutElements = document.querySelectorAll('.auth-only.logged-out');
            const loggedInElements = document.querySelectorAll('.auth-only.logged-in');
            
            html += `ë¡œê·¸ì•„ì›ƒ ë©”ë‰´ (.auth-only.logged-out): ${loggedOutElements.length}ê°œ\n`;
            loggedOutElements.forEach((el, i) => {
                const display = window.getComputedStyle(el).display;
                html += `  [${i+1}] ${el.textContent.trim().substring(0, 20)}... â†’ display: ${display}\n`;
            });
            
            html += `\në¡œê·¸ì¸ ë©”ë‰´ (.auth-only.logged-in): ${loggedInElements.length}ê°œ\n`;
            loggedInElements.forEach((el, i) => {
                const display = window.getComputedStyle(el).display;
                html += `  [${i+1}] ${el.textContent.trim().substring(0, 20)}... â†’ display: ${display}\n`;
            });
            
            html += '</pre>';
            
            detailDiv.innerHTML = html;
            
            // ìƒíƒœ ë©”ì‹œì§€
            if (localUser || sessionUser) {
                statusDiv.className = 'status success';
                statusDiv.innerHTML = 'âœ… ë¡œê·¸ì¸ ë°ì´í„° ìˆìŒ';
                if (!hasClass) {
                    statusDiv.innerHTML += '<br>âš ï¸ í•˜ì§€ë§Œ body.user-logged-in í´ë˜ìŠ¤ ì—†ìŒ!';
                    statusDiv.className = 'status error';
                }
            } else {
                statusDiv.className = 'status error';
                statusDiv.innerHTML = 'âŒ ë¡œê·¸ì¸ ë°ì´í„° ì—†ìŒ';
            }
        }
        
        // 2. í…ŒìŠ¤íŠ¸ ë¡œê·¸ì¸
        function testSetUser() {
            const userData = {
                id: 'jongjean@naver.com',
                name: 'Jongjean',
                role: 'admin',
                loginTime: new Date().toISOString()
            };
            
            localStorage.setItem('user', JSON.stringify(userData));
            console.log('âœ… í…ŒìŠ¤íŠ¸ ë¡œê·¸ì¸ ì‹¤í–‰:', userData);
            
            // body í´ë˜ìŠ¤ ì¶”ê°€
            document.body.classList.add('user-logged-in');
            console.log('âœ… body.user-logged-in í´ë˜ìŠ¤ ì¶”ê°€');
            
            alert('í…ŒìŠ¤íŠ¸ ë¡œê·¸ì¸ ì™„ë£Œ!\n\nìƒˆë¡œê³ ì¹¨í•˜ë©´ ë¡œê·¸ì¸ ìƒíƒœê°€ ìœ ì§€ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.');
            
            checkAll();
        }
        
        // 3. Body í´ë˜ìŠ¤ ì¶”ê°€
        function testAddBodyClass() {
            document.body.classList.add('user-logged-in');
            console.log('âœ… body.user-logged-in í´ë˜ìŠ¤ ì¶”ê°€');
            alert('body í´ë˜ìŠ¤ ì¶”ê°€ ì™„ë£Œ!\n\në¡œê·¸ì¸ ë©”ë‰´ê°€ ë³´ì—¬ì•¼ í•©ë‹ˆë‹¤.');
            checkAll();
        }
        
        // 4. ë¡œê·¸ì•„ì›ƒ
        function testLogout() {
            localStorage.removeItem('user');
            sessionStorage.removeItem('user');
            document.body.classList.remove('user-logged-in');
            console.log('âœ… ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ');
            alert('ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ!');
            checkAll();
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í™•ì¸
        window.addEventListener('load', () => {
            checkAll();
        });
    </script>
</body>
</html>
