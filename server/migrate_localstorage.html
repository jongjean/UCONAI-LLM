<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>LocalStorage â†’ DB ë§ˆì´ê·¸ë ˆì´ì…˜</title>
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
        }

        button:hover {
            background: #2980b9;
        }

        #output {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }

        .success {
            color: #27ae60;
        }

        .error {
            color: #e74c3c;
        }

        .info {
            color: #3498db;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ”„ LocalStorage â†’ ì„œë²„ DB ë§ˆì´ê·¸ë ˆì´ì…˜</h1>
        <p>ë¸Œë¼ìš°ì €ì— ì €ì¥ëœ ìŠ¬ë¼ì´ë“œ ë°ì´í„°ë¥¼ ì„œë²„ ë°ì´í„°ë² ì´ìŠ¤ë¡œ ì´ì „í•©ë‹ˆë‹¤.</p>

        <button onclick="checkLocalStorage()">1. LocalStorage í™•ì¸</button>
        <button onclick="migrateToServer()">2. ì„œë²„ë¡œ ì „ì†¡</button>
        <button onclick="clearLocalStorage()">3. LocalStorage ì‚­ì œ</button>

        <div id="output"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';
        const output = document.getElementById('output');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            output.innerHTML += `<span class="${type}">[${timestamp}] ${message}</span>\n`;
            output.scrollTop = output.scrollHeight;
        }

        function checkLocalStorage() {
            output.innerHTML = '';
            log('ğŸ” LocalStorage ê²€ì‚¬ ì¤‘...', 'info');

            const keys = Object.keys(localStorage);
            log(`ì´ ${keys.length}ê°œì˜ í‚¤ ë°œê²¬`, 'info');

            // ìŠ¬ë¼ì´ë“œ ê´€ë ¨ ë°ì´í„° ì°¾ê¸°
            const slideKeys = keys.filter(k => k.includes('slide') || k.includes('Slide') || k.includes('hero'));

            if (slideKeys.length === 0) {
                log('âŒ ìŠ¬ë¼ì´ë“œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                log('ë‹¤ìŒ í‚¤ë“¤ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤:', 'info');
                keys.forEach(k => log(`  - ${k}`, 'info'));
                return;
            }

            log(`\nâœ… ${slideKeys.length}ê°œì˜ ìŠ¬ë¼ì´ë“œ ê´€ë ¨ í‚¤ ë°œê²¬:`, 'success');
            slideKeys.forEach(key => {
                const data = localStorage.getItem(key);
                log(`\nğŸ“¦ ${key}:`, 'info');
                try {
                    const parsed = JSON.parse(data);
                    log(JSON.stringify(parsed, null, 2), 'info');
                } catch (e) {
                    log(data, 'info');
                }
            });
        }

        async function migrateToServer() {
            log('\nğŸš€ ì„œë²„ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œì‘...', 'info');

            // ê°€ì¥ ì¼ë°˜ì ì¸ localStorage í‚¤ íŒ¨í„´ë“¤
            const possibleKeys = [
                'heroSlides',
                'slides',
                'publicSlides',
                'esg_slides',
                'mainSlides'
            ];

            let slidesData = null;
            let foundKey = null;

            // í‚¤ ì°¾ê¸°
            for (const key of possibleKeys) {
                const data = localStorage.getItem(key);
                if (data) {
                    try {
                        slidesData = JSON.parse(data);
                        foundKey = key;
                        break;
                    } catch (e) {
                        continue;
                    }
                }
            }

            if (!slidesData) {
                log('âŒ ìŠ¬ë¼ì´ë“œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                log('checkLocalStorage()ë¥¼ ë¨¼ì € ì‹¤í–‰í•˜ì—¬ í‚¤ ì´ë¦„ì„ í™•ì¸í•˜ì„¸ìš”.', 'info');
                return;
            }

            log(`âœ… "${foundKey}"ì—ì„œ ë°ì´í„° ë°œê²¬`, 'success');

            // ë°°ì—´ë¡œ ë³€í™˜
            let slides = Array.isArray(slidesData) ? slidesData : [slidesData];
            log(`ğŸ“Š ì´ ${slides.length}ê°œì˜ ìŠ¬ë¼ì´ë“œ ë°œê²¬`, 'info');

            // ê° ìŠ¬ë¼ì´ë“œë¥¼ ì„œë²„ë¡œ ì „ì†¡
            let successCount = 0;
            let failCount = 0;

            for (let i = 0; i < slides.length; i++) {
                const slide = slides[i];
                log(`\n[${i + 1}/${slides.length}] "${slide.title || slide.shortTitle || 'Untitled'}" ì „ì†¡ ì¤‘...`, 'info');

                try {
                    // FormData ìƒì„± (ì´ë¯¸ì§€ ì—†ì´ í…ìŠ¤íŠ¸ë§Œ)
                    const formData = new FormData();
                    formData.append('boardId', 'notice');
                    formData.append('title', slide.title || slide.shortTitle || 'ì œëª© ì—†ìŒ');
                    formData.append('content', slide.description || slide.shortDescription || '');
                    formData.append('category', slide.categories?.[0] || 'notice');
                    formData.append('isHeroVisible', slide.isHeroVisible ? '1' : '0');
                    formData.append('slideOrder', slide.order || i + 1);

                    if (slide.shortTitle) formData.append('shortTitle', slide.shortTitle);
                    if (slide.shortDescription) formData.append('shortDescription', slide.shortDescription);
                    if (slide.videoUrl) formData.append('videoUrl', slide.videoUrl);
                    if (slide.maskOpacity) formData.append('maskOpacity', slide.maskOpacity);
                    if (slide.imageTransform) formData.append('imageTransform', JSON.stringify(slide.imageTransform));

                    // ì´ë¯¸ì§€ URLì´ ìˆìœ¼ë©´ ì¶”ê°€ (ì„œë²„ì—ì„œ ì²˜ë¦¬)
                    if (slide.image) {
                        formData.append('existingImageUrl', slide.image);
                    }

                    const response = await fetch(`${API_BASE}/posts`, {
                        method: 'POST',
                        body: formData
                    });

                    if (response.ok) {
                        const result = await response.json();
                        log(`  âœ… ì„±ê³µ (ID: ${result.id})`, 'success');
                        successCount++;
                    } else {
                        const error = await response.text();
                        log(`  âŒ ì‹¤íŒ¨: ${error}`, 'error');
                        failCount++;
                    }
                } catch (error) {
                    log(`  âŒ ì˜¤ë¥˜: ${error.message}`, 'error');
                    failCount++;
                }
            }

            log(`\nğŸ“Š ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ:`, 'info');
            log(`  âœ… ì„±ê³µ: ${successCount}ê°œ`, 'success');
            log(`  âŒ ì‹¤íŒ¨: ${failCount}ê°œ`, 'error');
        }

        function clearLocalStorage() {
            if (!confirm('ì •ë§ë¡œ LocalStorageì˜ ìŠ¬ë¼ì´ë“œ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            const keys = Object.keys(localStorage);
            const slideKeys = keys.filter(k => k.includes('slide') || k.includes('Slide') || k.includes('hero'));

            slideKeys.forEach(key => {
                localStorage.removeItem(key);
                log(`ğŸ—‘ï¸ "${key}" ì‚­ì œë¨`, 'info');
            });

            log(`\nâœ… ${slideKeys.length}ê°œì˜ í‚¤ ì‚­ì œ ì™„ë£Œ`, 'success');
        }
    </script>
</body>

</html>